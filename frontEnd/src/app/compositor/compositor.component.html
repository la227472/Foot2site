<!-- src/app/compositor/compositor.component.html -->
<div class="compositor-container">
  <h1>Cr√©er votre configuration PC</h1>

  @if (successMessage()) {
    <div class="alert alert-success">{{ successMessage() }}</div>
  }

  @if (errorMessage()) {
    <div class="alert alert-danger">{{ errorMessage() }}</div>
  }

  <form [formGroup]="compositionForm" class="composition-form">

    <!-- CPU -->
    <div class="form-group">
      <label for="cpu">
        <span class="component-icon">üñ•Ô∏è</span>
        Processeur (CPU) *
      </label>
      <select formControlName="cpu" id="cpu" class="form-select">
        <option value="">-- S√©lectionnez un processeur --</option>
        @for (cpu of cpus(); track cpu.id) {
          <option [value]="cpu.id">
            {{ cpu.marque }} {{ cpu.modele }} - {{ cpu.prix }}‚Ç¨ Score : {{cpu.score}}
            @if (cpu.stock === 0) { (Rupture de stock) }
          </option>
        }
      </select>
      @if (compositionForm.get('cpu')?.invalid && compositionForm.get('cpu')?.touched) {
        <small class="text-danger">Veuillez s√©lectionner un processeur</small>
      }
    </div>

    <!-- Carte M√®re -->
    <div class="form-group">
      <label for="motherboard">
        <span class="component-icon">üîß</span>
        Carte M√®re *
      </label>
      <select formControlName="motherboard" id="motherboard" class="form-select">
        <option value="">-- S√©lectionnez une carte m√®re --</option>
        @for (mb of motherboards(); track mb.id) {
          <option [value]="mb.id">
            {{ mb.marque }} {{ mb.modele }} - {{ mb.prix }}‚Ç¨ Score : {{mb.score}}
          </option>
        }
      </select>
      @if (compositionForm.get('motherboard')?.invalid && compositionForm.get('motherboard')?.touched) {
        <small class="text-danger">Veuillez s√©lectionner une carte m√®re</small>
      }
    </div>

    <!-- GPU -->
    <div class="form-group">
      <label for="gpu">
        <span class="component-icon">üéÆ</span>
        Carte Graphique (GPU) *
      </label>
      <select formControlName="gpu" id="gpu" class="form-select">
        <option value="">-- S√©lectionnez une carte graphique --</option>
        @for (gpu of gpus(); track gpu.id) {
          <option [value]="gpu.id">
            {{ gpu.marque }} {{ gpu.modele }} - {{ gpu.prix }}‚Ç¨ Score : {{gpu.score}}
          </option>
        }
      </select>
    </div>

    <!-- M√©moire RAM -->
    <div class="form-group">
      <label for="memory">
        <span class="component-icon">üíæ</span>
        M√©moire RAM *
      </label>
      <select formControlName="memory" id="memory" class="form-select">
        <option value="">-- S√©lectionnez la m√©moire --</option>
        @for (mem of memories(); track mem.id) {
          <option [value]="mem.id">
            {{ mem.marque }} {{ mem.modele }} - {{ mem.prix }}‚Ç¨ Score : {{mem.score}}
          </option>
        }
      </select>
    </div>

    <!-- Disque Dur -->
    <div class="form-group">
      <label for="hardDisk">
        <span class="component-icon">üíø</span>
        Disque Dur / SSD *
      </label>
      <select formControlName="hardDisk" id="hardDisk" class="form-select">
        <option value="">-- S√©lectionnez un disque --</option>
        @for (hd of hardDisks(); track hd.id) {
          <option [value]="hd.id">
            {{ hd.marque }} {{ hd.modele }} - {{ hd.prix }}‚Ç¨ Score : {{hd.score}}
          </option>
        }
      </select>
    </div>

    <!-- Alimentation -->
    <div class="form-group">
      <label for="psu">
        <span class="component-icon">‚ö°</span>
        Alimentation (PSU) *
      </label>
      <select formControlName="psu" id="psu" class="form-select">
        <option value="">-- S√©lectionnez une alimentation --</option>
        @for (psu of psus(); track psu.id) {
          <option [value]="psu.id">
            {{ psu.marque }} {{ psu.modele }} - {{ psu.prix }}‚Ç¨ Score : {{psu.score}}
          </option>
        }
      </select>
    </div>

    <!-- Bo√Ætier -->
    <div class="form-group">
      <label for="box">
        <span class="component-icon">üì¶</span>
        Bo√Ætier *
      </label>
      <select formControlName="box" id="box" class="form-select">
        <option value="">-- S√©lectionnez un bo√Ætier --</option>
        @for (box of boxes(); track box.id) {
          <option [value]="box.id">
            {{ box.marque }} {{ box.modele }} - {{ box.prix }}‚Ç¨ Score : {{box.score}}
          </option>
        }
      </select>
    </div>

    <!-- Prix Total -->
    <div class="total-price">
      <h3>Prix Total: <span class="price">{{ totalPrice() }}‚Ç¨</span></h3>
    </div>

    <!-- Bouton d'enregistrement -->
    <button
      type="button"
      class="btn btn-primary"
      [disabled]="loading() || !hasAtLeastOneComponent()"
      (click)="onSubmit('save')">
      @if (loading()) {
        <span class="spinner"></span> Chargement...
      } @else {
        Enregistrer la configuration
      }
    </button>

    <button
      type="button"
      class="btn btn-panier"
      [disabled]="!hasAtLeastOneComponent()"
      (click)="onSubmit('cart')">
      Au panier
    </button>
  </form>

  <!-- Modal pour le nom de la configuration -->
  @if (showNameModal()) {
    <div class="modal-overlay" (click)="cancelSave()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>Nommer votre configuration</h2>

        <form [formGroup]="configNameForm" (ngSubmit)="saveConfiguration()">
          <div class="form-group">
            <label for="nomConfiguration">Nom de la configuration *</label>
            <input
              type="text"
              id="nomConfiguration"
              formControlName="nomConfiguration"
              class="form-control"
              placeholder="Ex: PC Gaming Ultra 2024"
              [class.is-invalid]="nomConfiguration?.invalid && nomConfiguration?.touched">
            @if (nomConfiguration?.invalid && nomConfiguration?.touched) {
              <small class="text-danger">
                @if (nomConfiguration?.errors?.['required']) { Le nom est requis }
                @if (nomConfiguration?.errors?.['minlength']) { Minimum 3 caract√®res }
              </small>
            }
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" (click)="cancelSave()">
              Annuler
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="configNameForm.invalid || loading()">
              @if (loading()) {
                <span class="spinner"></span> Enregistrement...
              } @else {
                Confirmer
              }
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
